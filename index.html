<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自然と科学</title>
    <link rel="stylesheet" href="style.css?v=20260111">
    <link rel="stylesheet" href="sort.css">
    <link rel="stylesheet" href="mobile.css" id="responsive-css" media="(max-width: 768px)">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar: Info & Stats -->
        <aside class="sidebar glass-panel">
            <h1>自然と科学 🧪</h1>

            <nav class="main-nav">
                <button id="nav-field" class="nav-btn active">🏞️ 採取フィールド</button>
                <button id="nav-lab" class="nav-btn">⚗️ 合成ラボ</button>
                <button id="nav-book" class="nav-btn">📖 図鑑</button>
            </nav>

            <div class="stats">
                <p>発見数: <span id="discovery-count">0</span> / <span id="total-count">??</span></p>
                <div
                    style="margin: 5px 0; width: 100%; background: rgba(0,0,0,0.1); border-radius: 5px; overflow: hidden; height: 12px; position: relative;">
                    <div id="sidebar-progress-bar"
                        style="width: 0%; height: 100%; background: linear-gradient(90deg, #4caf50, #81c784); transition: width 0.5s ease;">
                    </div>
                    <span id="sidebar-progress-text"
                        style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 0.65rem; color: #333; font-weight: bold; text-shadow: 0 0 2px rgba(255,255,255,0.8);">0%</span>
                </div>
                <button id="delete-save-btn" class="text-btn"
                    style="color: #e53935; margin-top:10px; font-size:0.8rem;">🗑️ データを消す</button>
                <div style="margin-top: 5px; display: flex; gap: 5px;">
                    <button id="export-save-btn" class="text-btn" style="color: #1976d2; font-size:0.8rem;">📤
                        保存</button>
                    <button id="import-save-btn" class="text-btn" style="color: #f57c00; font-size:0.8rem;">📥
                        読込</button>
                </div>

                <div class="view-mode-controls" style="margin-top: 8px; font-size: 0.8rem; text-align: right;">
                    <span>表示:</span>
                    <button class="text-btn" id="btn-view-auto">Auto</button>
                    <button class="text-btn" id="btn-view-pc">PC</button>
                    <button class="text-btn" id="btn-view-mobile">Mob</button>
                    <button class="text-btn" id="btn-toggle-lite"
                        style="margin-left: 5px; border-left: 1px solid #ccc; padding-left: 10px;">✨ Lite</button>

                </div>
            </div>


            <div id="message-log" class="message-log">

            </div>
        </aside>

        <!-- Main Workspace Areas (Switched via JS) -->
        <main class="workspace">

            <!-- VIEW 1: Exploration Field -->
            <div id="view-field" class="view-panel active">
                <div class="field-container glass-panel">
                    <div class="field-header">
                        <h2>採取フィールド</h2>
                        <p>自然をクリックして素材を集めよう</p>
                    </div>

                    <div class="nature-scene">
                        <!-- Clickable Areas -->
                        <div class="gather-spot water-spot" data-id="water" title="海水を汲む / 貝殻を拾う">🌊 海</div>
                        <div class="gather-spot forest-spot" data-id="forest" title="森を探索する">🌲 森</div>
                        <div class="gather-spot earth-spot" data-id="land" title="土を掘る">🌱 大地</div>
                        <div class="gather-spot tree-spot" data-id="air" title="空を観察する">💨 空</div>
                        <div class="gather-spot sun-spot" data-id="sun" title="日光を集める">☀️ 太陽</div>
                        <!-- COVE Added -->
                        <div class="gather-spot cave-spot" data-id="ore" title="鉱石を採掘する">⛏️ 洞窟</div>
                        <div class="gather-spot onsen-spot" data-id="onsen" title="硫黄を採る">♨️ 温泉</div>
                        <div class="gather-spot river-spot" data-id="river" title="砂金を探す">🌊 川
                        </div>
                        <div class="gather-spot home-spot" data-id="home" title="生活の痕跡">🏠 家</div>
                        <div class="gather-spot oil-spot" data-id="oil" title="原油を採掘する" style="display:none;">
                            🛢️ 油田
                        </div>
                        <div class="gather-spot foreign-spot" data-id="foreign" title="世界へ旅立つ"
                            style="display:none; background: linear-gradient(135deg, #42a5f5, #1e88e5); color:white;">🚢
                            出航</div>

                        <!-- Southeast Asia Spots -->
                        <div class="gather-spot jungle-spot" data-id="jungle" title="ゴムノキを探す"
                            style="display:none; background: #66bb6a; color:white;">🌳 密林</div>
                        <div class="gather-spot spice-spot" data-id="spice_field" title="香辛料を探す"
                            style="display:none; background: #ffa726; color:white;">🌶️ 香辛料の森</div>

                        <!-- America Spots -->
                        <div class="gather-spot corn-spot" data-id="corn_field" title="トウモロコシを収穫する"
                            style="display:none; background: #fbc02d; color:black;">🌽 大農園</div>

                        <!-- South America Spots -->
                        <div class="gather-spot andes-spot" data-id="andes" title="ジャガイモを探す"
                            style="display:none; background: #795548; color:white;">⛰️ アンデス山脈</div>
                        <div class="gather-spot amazon-spot" data-id="amazon" title="カカオを探す"
                            style="display:none; background: #388e3c; color:white;">🍫 アマゾン川</div>
                        <div class="gather-spot mine-spot" data-id="araxa_mine" title="ニオブを採掘する"
                            style="display:none; background: #5d4037; color:white;">⛏️ アラシャ鉱山</div>
                        <div class="gather-spot salt-lake-spot" data-id="salt_lake" title="塩を採取する"
                            style="display:none; background: #e0f7fa; color:#006064;">🧂 塩湖</div>

                        <!-- Europe Spots -->
                        <div class="gather-spot olive-spot" data-id="olive_grove" title="オリーブを探す"
                            style="display:none; background: #c0ca33; color:white;">🫒 オリーブ畑</div>
                        <div class="gather-spot coast-spot" data-id="spanish_coast" title="蛍石を探す"
                            style="display:none; background: #03a9f4; color:white;">🏖️ 地中海沿岸</div>

                        <!-- Australia Spots -->
                        <div class="gather-spot desert-spot" data-id="red_desert" title="ボーキサイトを採掘する"
                            style="display:none; background: #d32f2f; color:white;">🏜️ 赤い荒野</div>

                        <!-- South Africa Spots -->
                        <div class="gather-spot savannah-spot" data-id="savannah" title="レアメタルを探す"
                            style="display:none; background: #ffca28; color:black;">🦁 サバンナ</div>

                        <!-- Moon Spots -->
                        <div class="gather-spot crater-spot" data-id="crater" title="月面を調査する"
                            style="display:none; background: #37474f; color:white; border: 1px solid #78909c;">🌑 クレーター
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW 2: Crafting Lab -->
            <div id="view-lab" class="view-panel" style="display: none;">

                <!-- Section 1: Crafting -->
                <div class="machine-section glass-panel">
                    <div class="machine-title">合成ラボ</div>

                    <div class="slots-container">
                        <div class="slot-wrapper">
                            <div id="slot-1" class="element-slot empty" data-index="0">
                                <span class="slot-placeholder">素材A</span>
                            </div>
                        </div>
                        <div class="operator">+</div>
                        <div class="slot-wrapper">
                            <div id="slot-2" class="element-slot empty" data-index="1">
                                <span class="slot-placeholder">素材B</span>
                            </div>
                        </div>
                        <div class="operator">+</div>
                        <div class="slot-wrapper">
                            <div id="slot-3" class="element-slot empty" data-index="2">
                                <span class="slot-placeholder">素材C</span>
                            </div>
                        </div>
                        <div class="operator">+</div>
                        <div class="slot-wrapper">
                            <div id="slot-4" class="element-slot empty" data-index="3">
                                <span class="slot-placeholder">素材D</span>
                            </div>
                        </div>
                        <div class="operator">+</div>
                        <div class="slot-wrapper">
                            <div id="slot-5" class="element-slot empty" data-index="4">
                                <span class="slot-placeholder">素材E</span>
                            </div>
                        </div>
                        <div class="operator">=</div>
                        <div class="slot-wrapper">
                            <div id="slot-result" class="element-slot result locked">
                                <span class="slot-placeholder">?</span>
                            </div>
                        </div>
                    </div>

                    <div class="control-area">
                        <button id="craft-btn" class="action-btn">合成する！</button>
                        <button id="reset-slots-btn" class="text-btn">クリア</button>
                    </div>
                </div>

                <!-- Section 2: Smeltery -->
                <div class="machine-section glass-panel" style="margin-top: 20px;">
                    <div class="machine-title" style="margin-bottom: 10px;">製錬所</div>
                    <div class="refinery-container">
                        <div class="refinery-info">
                            <p>鉱石・木炭・火・土器を使って金属を製錬する。</p>
                        </div>
                        <button id="refine-btn" class="action-btn secondary">🔥 製錬 (鉱石+木炭)</button>
                    </div>
                </div>

                <!-- Section 3: Distillery -->
                <div class="machine-section glass-panel" style="margin-top: 20px;">
                    <div class="machine-title" style="margin-bottom: 10px;">蒸留所</div>
                    <div class="refinery-container">
                        <div class="refinery-info">
                            <p>液体を土器で沸騰させて成分を分離する。</p>
                            <p style="font-size: 0.8rem; color: #d32f2f;">※[土器]と[火]が必要</p>
                        </div>
                        <button id="distill-btn" class="action-btn"
                            style="background: #29b6f6; box-shadow: 0 4px 10px rgba(41, 182, 246, 0.3);">💧 蒸留
                            (海水/ワイン)</button>
                    </div>
                </div>

                <!-- Section 4: Carbonization Facility -->
                <div class="machine-section glass-panel" style="margin-top: 20px;">
                    <div class="machine-title" style="margin-bottom: 10px;">乾留所</div>
                    <div class="refinery-container">
                        <div class="refinery-info">
                            <p>火を使って木材・石炭・薬品を蒸し焼き（乾留）にする。</p>
                        </div>
                        <button id="carbonize-btn" class="action-btn"
                            style="background: #4e342e; box-shadow: 0 4px 10px rgba(78, 52, 46, 0.3);">⬛ 乾留
                            (木材/石炭)</button>
                    </div>
                </div>

                <!-- Section 5: Extraction Facility -->
                <div class="machine-section glass-panel" style="margin-top: 20px;">
                    <div class="machine-title" style="margin-bottom: 10px;">抽出所</div>
                    <div class="refinery-container">
                        <div class="refinery-info">
                            <p>化学反応を利用して混合物から成分を取り出す。</p>
                        </div>
                        <button id="extract-btn" class="action-btn"
                            style="background: #66bb6a; box-shadow: 0 4px 10px rgba(102, 187, 106, 0.3);">⚗️ 抽出
                            (化学分離)</button>
                    </div>
                </div>

                <!-- Section 6: Oil Refinery (Hidden by default) -->
                <div id="oil-refinery-section" class="machine-section glass-panel"
                    style="margin-top: 20px; display: none;">
                    <div class="machine-title" style="margin-bottom: 10px;">製油所</div>
                    <div class="refinery-container">
                        <div class="refinery-info">
                            <p>蒸留塔を使って原油を様々な石油製品に分離する。</p>
                            <p style="font-size: 0.8rem; color: #555;">※[蒸留塔]が必要</p>
                        </div>
                        <button id="oil-refine-btn" class="action-btn"
                            style="background: #ef5350; box-shadow: 0 4px 10px rgba(239, 83, 80, 0.3);">🛢️
                            石油精製</button>
                    </div>
                </div>

            </div>

            <!-- VIEW 3: Encyclopedia -->
            <div id="view-book" class="view-panel" style="display: none;">
                <div class="encyclopedia-container glass-panel">
                    <div class="field-header">
                        <h2>図鑑</h2>
                        <p>発見した要素の記録</p>
                        <!-- Encyclopedia Specific Progress -->
                        <div
                            style="margin: 10px auto; width: 80%; max-width: 400px; background: rgba(0,0,0,0.1); border-radius: 10px; overflow: hidden; height: 20px; position: relative;">
                            <div id="discovery-progress-bar"
                                style="width: 0%; height: 100%; background: linear-gradient(90deg, #4caf50, #81c784); transition: width 0.5s ease;">
                            </div>
                            <span id="discovery-progress-text"
                                style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 0.75rem; color: #333; font-weight: bold; text-shadow: 0 0 2px rgba(255,255,255,0.8);">0%</span>
                        </div>

                        <!-- Tabs -->
                        <div class="book-tabs"
                            style="display: flex; justify-content: center; gap: 10px; margin: 15px 0;">
                            <button id="tab-elements" class="action-btn"
                                style="padding: 6px 20px; font-size: 0.9rem; background: #2e7d32; color: white;">要素</button>
                            <button id="tab-industry" class="action-btn"
                                style="padding: 6px 20px; font-size: 0.9rem; background: rgba(255,255,255,0.5); color: #555;">工業</button>
                        </div>

                        <!-- Search Bar -->
                        <div class="search-bar-container" style="padding: 0 10px 10px; text-align: center;">
                            <input type="text" id="book-search-input" placeholder="🔍 名前で検索..."
                                style="padding: 8px 15px; width: 80%; max-width: 300px; border-radius: 20px; border: 1px solid #ccc; font-size: 0.9rem; outline: none;">
                        </div>

                        <div id="encyclopedia-controls"
                            style="margin-top: 10px; display: flex; justify-content: center; gap: 10px;">
                            <button id="sort-id-btn" class="nav-btn"
                                style="padding: 5px 15px; font-size: 0.8rem; height: auto;">ID順</button>
                            <button id="sort-emoji-btn" class="nav-btn"
                                style="padding: 5px 15px; font-size: 0.8rem; height: auto;">絵文字順</button>
                        </div>
                    </div>
                    <div id="encyclopedia-grid" class="element-list"
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px;">
                        <!-- Items injected via JS -->
                    </div>
                </div>
            </div>

        </main>

        <!-- Bottom Panel: Inventory (Shared) -->
        <section class="inventory glass-panel">
            <div class="inventory-header">
                <h2>持ち物</h2>
                <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                    <input type="text" id="inventory-search" placeholder="🔍 検索..."
                        style="padding: 5px 10px; border-radius: 15px; border: none; font-size: 0.9rem; width: 150px; background: rgba(255,255,255,0.8); box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);">
                    <button id="manual-sort-btn" class="text-btn"
                        style="color: #666; font-size: 0.8rem; background: rgba(255,255,255,0.5); padding: 4px 8px; border-radius: 4px;">🖐️
                        並べ替え</button>
                    <span class="inventory-hint">クリックで装置にセット</span>
                </div>
            </div>
            <div id="element-list" class="element-list">
                <!-- Elements injected here -->
            </div>
        </section>
    </div>

    <!-- Element Details Modal -->
    <div id="detail-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content glass-panel">
            <span id="close-modal" class="close-btn">&times;</span>
            <div id="modal-body">
                <!-- Content injected via JS -->
            </div>
        </div>
    </div>

    <!-- World Map Modal -->
    <div id="map-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content glass-panel" style="max-width: 600px; text-align: center;">
            <span id="close-map" class="close-btn">&times;</span>
            <h2>🗺️ 世界地図</h2>
            <p>行き先を選択してください</p>
            <div class="map-container"
                style="margin-top:20px; display:grid; grid-template-columns: 1fr 1fr; gap:20px; padding: 20px;">
                <!-- Local -->
                <div id="dest-local" class="map-destination"
                    style="border: 2px solid #ccc; padding: 20px; border-radius: 10px; cursor: pointer; background: #e8f5e9;">
                    <div style="font-size: 3rem;">🗾</div>
                    <h3>日本 (拠点)</h3>
                    <p style="font-size: 0.8rem; color: #555;">いつもの採取場所</p>
                </div>
                <!-- Foreign -->
                <div id="dest-foreign" class="map-destination"
                    style="border: 2px solid #2196f3; padding: 20px; border-radius: 10px; cursor: pointer; background: #e3f2fd;">
                    <div style="font-size: 3rem;">🌏</div>
                    <h3>東南アジア</h3>
                    <p style="font-size: 0.8rem; color: #555;">ゴムノキと香辛料の産地</p>
                </div>
                <!-- America -->
                <div id="dest-america" class="map-destination"
                    style="border: 2px solid #81c784; padding: 20px; border-radius: 10px; cursor: pointer; background: #f1f8e9;">
                    <div style="font-size: 3rem;">🤠</div>
                    <h3>北米</h3>
                    <p style="font-size: 0.8rem; color: #555;">未知の穀物を求めて</p>
                </div>
                <!-- South America -->
                <div id="dest-south-america" class="map-destination"
                    style="border: 2px solid #8d6e63; padding: 20px; border-radius: 10px; cursor: pointer; background: #efebe9;">
                    <div style="font-size: 3rem;">🦙</div>
                    <h3>南米</h3>
                    <p style="font-size: 0.8rem; color: #555;">アンデス山脈とアマゾン川</p>
                </div>
                <!-- Europe (Spain) -->
                <div id="dest-europe" class="map-destination"
                    style="border: 2px solid #ffeb3b; padding: 20px; border-radius: 10px; cursor: pointer; background: #fffde7;">
                    <div style="font-size: 3rem;">🐂</div>
                    <h3>スペイン</h3>
                    <p style="font-size: 0.8rem; color: #555;">太陽と情熱の国</p>
                </div>
                <!-- Australia -->
                <div id="dest-australia" class="map-destination"
                    style="border: 2px solid #ff5722; padding: 20px; border-radius: 10px; cursor: pointer; background: #fbe9e7;">
                    <div style="font-size: 3rem;">🦘</div>
                    <h3>オーストラリア</h3>
                    <p style="font-size: 0.8rem; color: #555;">広大な赤い大地</p>
                </div>
                <!-- South Africa -->
                <div id="dest-south-africa" class="map-destination"
                    style="border: 2px solid #ffca28; padding: 20px; border-radius: 10px; cursor: pointer; background: #fff8e1;">
                    <div style="font-size: 3rem;">💎</div>
                    <h3>南アフリカ</h3>
                    <p style="font-size: 0.8rem; color: #555;">鉱物資源の宝庫</p>
                </div>
            </div>

            <!-- Rocket Map Section -->
            <div id="rocket-map-section"
                style="display:none; border-top:1px solid #ddd; margin-top:20px; padding-top:10px; width: 100%;">
                <h3 style="margin:0 0 10px 0;">宇宙</h3>
                <div class="map-grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                    <div id="dest-moon" class="map-destination"
                        style="border: 2px solid #546e7a; padding: 20px; border-radius: 10px; cursor: pointer; background: #eceff1; text-align: center;">
                        <div style="font-size: 3rem;">🌑</div>
                        <h3>月面</h3>
                        <p style="font-size: 0.8rem; color: #555;">静寂の世界</p>
                    </div>
                </div>
            </div>

            <button id="close-map"
                style="margin-top:20px; padding:10px 20px; background:#ddd; border:none; border-radius:5px; cursor:pointer;">閉じる</button>

            <script src="script.js"></script>
</body>

</html>
<!-- Updated -->